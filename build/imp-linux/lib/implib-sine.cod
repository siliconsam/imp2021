{----------------------------------------------------------------------------}
    ! Simple trig library functions to demonstrate
    ! how to cross-link with the C library functions
    ! Copyright 2002 NB Information Limited
    !
    ! Declare useful trignometry functions
    !
    %external %long %real %function sine(%longreal r)
 0000                      L 1000  EQU $
 0000 C8 00 00 01                     ENTER 0000, 1

        %external %long %real %fn %spec C Lib Sine %alias "sin" ( %longreal r)

        ! Slightly arbitrary - the C library tries to work with larger values,
        ! but this demonstrates keeping the error case in the IMP world
        %if |r| > 30000 %then %signal 10,1,5
 0004 DD 45 08                        FLD QWORD [EBP+ 8]
 0007 D9 E1                           FABS ST( 0),ST
 0009 DB 05 00 00 00 00               FILD [COT+0000]
 000F DE D9                           FCOMPP ST( 1),ST
 0011 DF E0                           FSTSW AX
 0013 9E                              SAHF
 0014 73 00                           JAE L 1001
 0016 B8 0A 00 00 00                  MOV EAX, 10
 001B 50                              PUSH EAX
 001C B8 05 00 00 00                  MOV EAX, 5
 0021 50                              PUSH EAX
 0022 B8 01 00 00 00                  MOV EAX, 1
 0027 50                              PUSH EAX
 0028 E8 0B 00                        CALL '_IMPSIGNAL' (EXTERN  11)
 002B 83 C4 0C                        ADD ESP, 12
 002E                      L 1001  EQU $

        %result = C Lib Sine(r)
 002E DD 45 08                        FLD QWORD [EBP+ 8]
 0031 83 EC 08                        SUB ESP, 8
 0034 89 E6                           MOV ESI,ESP
 0036 DD 1E                           FSTP QWORD [ESI]
 0038 E8 62 00                        CALL 'CLIBSINE' (EXTERN  98)
 003B 83 C4 08                        ADD ESP, 8
 003E C9                              LEAVE
 003F C3                              RET
    %end

{----------------------------------------------------------------------------}
%endoffile
      _TEXT  ENDS
      CONST  SEGMENT WORD PUBLIC 'CONST'
 0000 30 75                           db 30,75 ; 0u
 0002 00 00                           db 00,00 ; ..
      CONST  ENDS
      _TEXT  SEGMENT WORD PUBLIC 'CODE'
            ENDS
      DATA  SEGMENT WORD PUBLIC 'DATA'
      DATA    ENDS
              ENDS
      _SWTAB  SEGMENT WORD PUBLIC '_SWTAB'
      _SWTAB   ENDS
