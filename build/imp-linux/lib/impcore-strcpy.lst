         Edinburgh IMP77 Compiler - Version 8.4

   1  {------------------------------------------------------------------------------}
   2      %external %routine impstrcpy ( %byte %name dst, src, %integer len)
   3          %integer i
   4          %integer count
   5          %byte dlen,slen
   6          %byte %name srcx,dstx
   7  
   8          %if (len = 0) %then len = MAXLENIMPSTRING; ! string(*)name - comes from general %name's etc
   9  
   10          dlen = 0;      ! destination length = 0
   11          slen = src;    ! fetch the source length
   12  
   13          %signal 6,1,2 %if (slen > len)
   14  
   15          count = slen
   16          dlen = dlen + count;
   17  
   18          ! update the destination count
   19          dstx == byteinteger( addr( dst) ); ! get the address
   20          dstx = dlen;                       ! set the new length
   21  
   22          ! copy across the source chars (and the lengths)
   23          %for i = 1,1,count %cycle
   24              srcx == byteinteger( addr(src) + i )
   25              dstx == byteinteger( addr(dst) + i )
   26              dstx = srcx
   27          %repeat
   28      %end
   29  
   30  {------------------------------------------------------------------------------}
   31  %endoffile

   20 Statements compiled
